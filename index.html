<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Noto+Color+Emoji&family=Noto+Emoji:wght@300..700&family=Noto+Sans+Thai:wght@100..900&display=swap"
      rel="stylesheet">
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        font-family:
          'Kanit',
          'Noto Sans Thai',
          'Noto Emoji',
          'Google Sans',
          'Segoe UI',
          Arial,
          sans-serif;
        background: radial-gradient(circle at top, #fffdf6 0%, #ffe8c7 45%, #ffd4c2 80%, #ffcde2 100%);
        height: 100%;
        color: #4a2b18;
        opacity: 0;
        animation: fadeScene 0.85s ease-out forwards;
      }

      .scene {
        height: 100%;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        padding: 18px;
        opacity: 0;
        animation: sceneRise 0.9s cubic-bezier(0.16, 0.84, 0.44, 1) 0.05s forwards;
        filter: blur(0);
        transition:
          filter 5s cubic-bezier(0.19, 1, 0.22, 1),
          opacity 0.6s ease;
      }

      .scene.is-blurred {
        filter: blur(10px);
        pointer-events: none;
      }

      .scene.is-revealed {
        filter: blur(0);
      }

      .floating {
        position: absolute;
        font-size: 1.4rem;
        opacity: 0.65;
        animation: float 7s ease-in-out infinite;
        pointer-events: none;
      }

      .floating-1 {
        top: 10%;
        left: 18%;
        animation-delay: 0s;
      }

      .floating-2 {
        top: 70%;
        right: 16%;
        animation-delay: 1.2s;
      }

      .floating-3 {
        top: 25%;
        right: 32%;
        animation-delay: 2s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-14px);
        }
      }

      #paw-confetti {
        position: absolute;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
        opacity: 0;
        animation: fadeConfetti 0.6s ease 0.45s forwards;
      }

      #paw-confetti span {
        position: absolute;
        font-size: 1.25rem;
        opacity: 0;
        animation: drift 3.2s linear infinite;
        top: 110%;
      }

      @keyframes drift {
        0% {
          transform: translate3d(0, 20px, 0) rotate(-15deg) scale(0.8);
          opacity: 0;
        }
        15% {
          opacity: 1;
        }
        100% {
          transform: translate3d(var(--x), var(--rise), 0) rotate(25deg) scale(1.05);
          opacity: 0;
        }
      }

      @keyframes fadeScene {
        0% {
          opacity: 0;
          filter: blur(6px);
        }
        100% {
          opacity: 1;
          filter: blur(0);
        }
      }

      @keyframes sceneRise {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes cardReveal {
        0% {
          opacity: 0;
          transform: translateY(24px) scale(0.94);
        }
        60% {
          opacity: 1;
          transform: translateY(-4px) scale(1.02);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      @keyframes fadeConfetti {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }

      @keyframes photoPop {
        0% {
          opacity: 0;
          transform: rotate(-4deg) scale(0.8);
        }
        60% {
          opacity: 1;
          transform: rotate(1.2deg) scale(1.03);
        }
        100% {
          opacity: 1;
          transform: rotate(-1.5deg) scale(0.96);
        }
      }

      @keyframes cardFloat {
        0% {
          transform: translate3d(0, 0, 0) rotate(0deg);
        }
        50% {
          transform: translate3d(0, -12px, 0) rotate(-1deg);
        }
        100% {
          transform: translate3d(0, 0, 0) rotate(0deg);
        }
      }

      .card-orbit {
        display: inline-block;
        animation: cardFloat 3s ease-in-out 1s infinite;
      }

      @keyframes lyricGlow {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.55;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.9;
        }
      }

      @keyframes lyricShimmer {
        0% {
          filter: hue-rotate(0deg);
        }
        50% {
          filter: hue-rotate(26deg);
        }
        100% {
          filter: hue-rotate(0deg);
        }
      }

      .card {
        background: rgba(255, 255, 255, 0.96);
        border-radius: 28px;
        box-shadow: 0 20px 55px rgba(198, 128, 84, 0.35);
        padding: 32px 36px 26px;
        max-width: 420px;
        width: 100%;
        text-align: center;
        position: relative;
        z-index: 1;
        transform: translateY(18px) scale(0.96);
        opacity: 0;
        animation: cardReveal 0.85s cubic-bezier(0.16, 0.84, 0.44, 1) 0.18s forwards;
      }

      .eyebrow {
        text-transform: uppercase;
        letter-spacing: 0.3em;
        font-size: 0.72rem;
        color: #c76c32;
        margin-bottom: 10px;
      }

      h1 {
        font-size: 1.85rem;
        margin: 0;
        color: #6f2f00;
        font-weight: 700;
      }

      .subtitle {
        margin: 12px 0 18px;
        color: #5c4033;
        line-height: 1.55;
        font-weight: 300;
      }

      .lyrics-module {
        margin: 22px 0;
        padding: 18px 20px 16px;
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.75);
        box-shadow: 0 12px 35px rgba(238, 167, 114, 0.35);
        position: relative;
        overflow: hidden;
        isolation: isolate;
      }

      .lyrics-module::before,
      .lyrics-module::after {
        content: '';
        position: absolute;
        inset: 0;
        z-index: 0;
        opacity: 0.7;
        pointer-events: none;
      }

      .lyrics-module::before {
        background: radial-gradient(circle at 20% 20%, rgba(255, 201, 155, 0.85), transparent 55%);
        animation: lyricGlow 10s ease-in-out infinite;
      }

      .lyrics-module::after {
        background: radial-gradient(circle at 80% 0%, rgba(255, 177, 213, 0.75), transparent 55%);
        mix-blend-mode: screen;
        animation: lyricGlow 12s ease-in-out 1s infinite;
      }

      .lyrics-chip {
        position: relative;
        z-index: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        text-transform: uppercase;
        font-size: 0.72rem;
        letter-spacing: 0.2em;
        color: #c7773c;
      }

      .lyrics-chip-title {
        font-weight: 600;
      }

      .lyrics-status {
        font-size: 0.7rem;
        letter-spacing: 0.18em;
        color: #cf936e;
        transition: color 0.3s ease;
      }

      .lyrics-status.is-live {
        color: #d1307f;
      }

      .lyrics-window {
        position: relative;
        z-index: 1;
        margin-top: 14px;
        min-height: 96px;
        padding: 8px 4px;
        text-align: center;
        overflow: hidden;
      }

      .lyrics-window::before {
        content: '';
        position: absolute;
        inset: 18%;
        background: rgba(255, 255, 255, 0.4);
        filter: blur(22px);
        z-index: -1;
      }

      .lyrics-line {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 8px;
        font-size: 1.35rem;
        font-weight: 600;
        margin: 0;
        color: #6f2f00;
        letter-spacing: 0.04em;
        text-transform: none;
        opacity: 0;
        transform: translateY(24px) scale(0.96);
        transition:
          opacity 0.6s ease,
          transform 0.6s cubic-bezier(0.34, 1.4, 0.64, 1);
        pointer-events: none;
      }

      .lyrics-line.is-visible {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      .lyrics-line.is-fading-out {
        opacity: 0;
        transform: translateY(-18px) scale(0.95);
        transition:
          opacity 0.55s ease,
          transform 0.55s cubic-bezier(0.34, 0.95, 0.64, 1);
      }

      .lyrics-line span {
        display: inline-block;
        background: linear-gradient(120deg, #d07519, #d93989);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: lyricShimmer 5s ease-in-out infinite;
      }

      .lyrics-progress {
        position: relative;
        z-index: 1;
        margin-top: 18px;
        display: flex;
        gap: 6px;
      }

      .lyrics-progress span {
        flex: 1;
        height: 4px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.48);
        overflow: hidden;
        position: relative;
      }

      .lyrics-progress span::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, #f0a646, #f468af);
        transform-origin: left;
        transform: scaleX(0);
        transition: transform var(--progress-duration, 3600ms) linear;
      }

      .lyrics-progress span.is-active::after {
        transform: scaleX(1);
      }

      .lyrics-progress span.is-complete {
        opacity: 0.35;
      }

      .memory-carousel {
        position: relative;
        width: 100%;
        margin: 12px 0 24px;
        overflow: visible;
        padding: clamp(6px, 1.5vw, 12px) 0;
      }

      .memory-track {
        --memory-gap: clamp(12px, 3vw, 20px);
        display: flex;
        gap: var(--memory-gap);
        align-items: flex-start;
        justify-content: center;
        position: relative;
        width: 100%;
      }

      .memory-track.is-enhanced {
        --memory-viewport: min(520px, 96vw);
        --memory-peek-shift: min(58%, 220px);
        --memory-peek-crop: 46%;
        width: 100%;
        max-width: var(--memory-viewport);
        margin: 0;
        min-height: clamp(220px, 45vw, 320px);
        justify-content: center;
        align-items: center;
        padding: 0;
      }

      .dog-wrapper {
        flex: 0 0 clamp(160px, 32vw, 220px);
        display: flex;
        justify-content: center;
      }

      .memory-track.is-enhanced .dog-wrapper {
        position: absolute;
        inset: 0;
        display: flex;
        justify-content: center;
        opacity: 0;
        transform: translateX(0) scale(0.9);
        clip-path: inset(0 0 0 0);
        pointer-events: none;
        transition:
          opacity 0.6s ease,
          transform 0.6s cubic-bezier(0.4, 0, 0.2, 1),
          clip-path 0.6s ease;
      }

      .memory-track.is-enhanced .dog-wrapper.is-static {
        transition: none !important;
      }

      .memory-track.is-enhanced .dog-wrapper.is-active {
        position: relative;
        opacity: 1;
        transform: translateX(0) scale(1);
        clip-path: inset(0 0 0 0);
        pointer-events: auto;
        z-index: 3;
      }

      .memory-track.is-enhanced .dog-wrapper.is-prev,
      .memory-track.is-enhanced .dog-wrapper.is-next {
        opacity: 1;
        z-index: 2;
      }

      .memory-track.is-enhanced .dog-wrapper.is-prev {
        transform: translateX(calc(var(--memory-peek-shift) * -1)) scale(0.94);
        clip-path: inset(0 0 0 var(--memory-peek-crop));
      }

      .memory-track.is-enhanced .dog-wrapper.is-next {
        transform: translateX(var(--memory-peek-shift)) scale(0.94);
        clip-path: inset(0 var(--memory-peek-crop) 0 0);
      }

      .memory-track.is-enhanced .dog-wrapper.is-offscreen {
        opacity: 0;
        transform: translateX(calc(var(--memory-peek-shift) * 2.2)) scale(0.78);
        clip-path: inset(0 0 0 85%);
        z-index: 1;
      }

      .memory-track.is-enhanced .dog-wrapper.is-exiting {
        opacity: 0;
        transform: translateX(calc(var(--memory-peek-shift) * -1.3)) scale(0.86);
        clip-path: inset(0 0 0 65%);
        pointer-events: none;
      }

      @media (prefers-reduced-motion: reduce) {
        .memory-track.is-enhanced .dog-wrapper {
          transition: none;
        }
      }

      .verse {
        margin: 8px 0 18px;
        font-size: 0.95rem;
        color: #8a5b37;
        font-style: italic;
        line-height: 1.4;
      }

      .photo-frame {
        width: 100%;
        border-radius: 28px;
        overflow: hidden;
        border: 4px solid rgba(255, 255, 255, 0.8);
        transform: rotate(-1.5deg) scale(0.96);
        opacity: 0;
        animation: photoPop 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 0.35s forwards;
        background: linear-gradient(135deg, #ffe2c4, #ffd4ea);
        padding: 14px;
        box-sizing: border-box;
        aspect-ratio: 3 / 4;
        min-height: 280px;
      }

      .memory-carousel .photo-frame {
        opacity: 1;
        animation: none;
      }

      .photo-frame img,
      .photo-frame video {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 16px;
        margin-bottom: 0;
        background: #fdf4ea;
      }

      .signature {
        font-size: 0.95rem;
        color: #7a431b;
        margin: 0;
      }

      .tiny-note {
        font-size: 0.8rem;
        color: #a46b4e;
        margin-top: 6px;
      }

      .card-footer {
        margin-top: 18px;
      }

      .intro-overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 233, 214, 0.92);
        backdrop-filter: blur(6px);
        z-index: 5;
        transition: opacity 0.5s ease;
      }

      .intro-overlay.is-hidden {
        opacity: 0;
        pointer-events: none;
      }

      .intro-card {
        background: rgba(255, 255, 255, 0.96);
        border-radius: 24px;
        padding: 32px 40px;
        box-shadow: 0 18px 45px rgba(149, 84, 45, 0.25);
        text-align: center;
        max-width: 360px;
      }

      .intro-card h2 {
        margin: 0 0 12px;
        color: #6f2f00;
        font-size: 1.5rem;
      }

      .intro-card p {
        margin: 0 0 24px;
        color: #8a5b37;
        line-height: 1.4;
      }

      .intro-card button {
        background: #f8a13d;
        border: none;
        color: #fff;
        font-size: 1rem;
        font-weight: 600;
        padding: 12px 28px;
        border-radius: 999px;
        cursor: pointer;
        box-shadow: 0 12px 20px rgba(248, 161, 61, 0.35);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .intro-card button:focus-visible {
        outline: 2px solid #6f2f00;
        outline-offset: 4px;
      }

      .intro-card button:hover {
        transform: translateY(-2px);
        box-shadow: 0 16px 28px rgba(248, 161, 61, 0.45);
      }
    </style>
  </head>
  <body>
    <audio id="always-on-time" src="always-on-time.mp3" loop muted preload="auto"></audio>
    <div class="intro-overlay" id="intro-overlay">
      <div class="intro-card">
        <h2>‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏±‡∏á‡∏Ñ‡∏±‡∏ö?</h2>
        
        <button id="intro-button" type="button">Tap me to reveal ‚ú®</button>
      </div>
    </div>
    <div class="scene is-blurred">
      <div class="floating floating-1">üìë</div>
      <div class="floating floating-2">üêæ</div>
      <div class="floating floating-3">üìö</div>
      <div id="paw-confetti"></div>

      <div class="card-orbit">
        <article class="card">
          <div class="eyebrow">Research Collection Wrapped!</div>
          <h1>So proud of you mak mak kub</h1>
          <p class="subtitle">
            ‡∏°‡∏≤‡∏¢‡∏°‡∏≠‡∏•‡∏ó‡∏µ‡∏™‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏±‡∏Å‡πÜ‡∏Ñ‡∏±‡∏ö<br>
            ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏£‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ‡∏°‡∏≤‡∏Ñ‡∏≠‡∏¢‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏¢‡∏π
            ‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡∏î‡∏π‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á<br>
            But HE IS ALWAYS ON TIME.‚ú®
          </p>
          <section class="lyrics-module" aria-label="Always On Time lyrics moment">
            <div class="lyrics-chip">
              <span class="lyrics-chip-title">Always On Time</span>
              <span class="lyrics-status" id="lyrics-status">Live lyrics</span>
            </div>
            <div class="lyrics-window" aria-live="polite">
              <p class="lyrics-line is-visible" data-line-slot="0">
                <span>Jesus</span>
              </p>
              <p class="lyrics-line" data-line-slot="1" aria-hidden="true">
                <span></span>
              </p>
            </div>
            <div class="lyrics-progress" id="lyrics-progress" aria-hidden="true"></div>
          </section>
          <p class="verse">
            ‚Äú‡∏ô‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏∞ ‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÜ ‡∏ö‡∏±‡∏î‡∏ô‡∏µ‡πâ ‡∏°‡∏±‡∏ô‡∏á‡∏≠‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ ‡πÄ‡∏à‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠? ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏ñ‡∏¥‡πà‡∏ô‡∏ó‡∏∏‡∏£‡∏Å‡∏±‡∏ô‡∏î‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏´‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏á‚Äù ‚Äî ‡∏≠‡∏¥‡∏™‡∏¢‡∏≤‡∏´‡πå 43:19
          </p>
          <section class="memory-carousel" aria-label="Prae memories carousel">
            <div class="memory-track">
              <div class="dog-wrapper">
                <div class="photo-frame">
                  <img src="carousel-00001.jpeg" alt="Prae memory photo 1" loading="eager">
                </div>
              </div>
              <div class="dog-wrapper">
                <div class="photo-frame">
                  <img src="carousel-00002.png" alt="Prae memory photo 2" loading="eager">
                </div>
              </div>
              <div class="dog-wrapper">
                <div class="photo-frame">
                  <img src="carousel-00003.jpeg" alt="Prae memory photo 3" loading="eager">
                </div>
              </div>
            </div>
          </section>
          <div class="card-footer">
            <p class="signature">Golden Retriever cheers coming your way üêï‚ú®</p>
            <p class="tiny-note">‡∏£‡∏±‡∏Å‡∏°‡∏≤‡∏Å‡πÜ‡∏Ñ‡∏±‡∏ö ‡∏°‡∏≤‡∏¢‡∏°‡∏≠‡∏•‡∏ó‡∏µ‡∏™‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πâ‡∏ô‡πÄ‡∏î‡πâ‡∏ô ‚ù§Ô∏è</p>
          </div>
        </article>
      </div>
    </div>

    <script>
      (function () {
        var pawLayer = document.getElementById('paw-confetti');
        var icons = ['üêæ', 'ü¶¥', 'üìì'];
        var pieces = 26;

        for (var i = 0; i < pieces; i++) {
          var span = document.createElement('span');
          span.textContent = icons[i % icons.length];
          span.style.left = Math.random() * 100 + '%';
          span.style.top = Math.random() * 100 + '%';
          span.style.animationDelay = (Math.random() * 2.2).toFixed(2) + 's';
          span.style.animationDuration = (2.6 + Math.random() * 1.8).toFixed(2) + 's';
          span.style.setProperty('--x', (Math.random() * 80 - 40) + 'px');
          span.style.setProperty('--rise', (-260 - Math.random() * 140) + 'px');
          pawLayer.appendChild(span);
        }

        var introButton = document.getElementById('intro-button');
        var introOverlay = document.getElementById('intro-overlay');
        var scene = document.querySelector('.scene');
        var soundtrack = document.getElementById('always-on-time');
        var hasQueuedSoundtrack = false;
        var SOUNDTRACK_START_DELAY = 2000;
        var memorySources = [
          'carousel-00001.jpeg',
          'carousel-00002.png',
          'carousel-00003.jpeg',
          'carousel-00004.mp4',
          'carousel-00005.jpeg',
          'carousel-00006.jpeg',
          'carousel-00007.jpeg',
          'carousel-00008.mp4',
          'carousel-00009.jpeg',
          'carousel-00010.jpeg',
          'carousel-00011.jpeg',
          'carousel-00012.jpeg',
          'carousel-00013.jpeg',
          'carousel-00014.jpeg',
          'carousel-00015.mp4',
          'carousel-00016.jpeg',
          'carousel-00017.jpeg',
          'carousel-00018.jpeg',
          'carousel-00019.jpeg',
          'carousel-00020.jpeg'
        ];
        var memoryCarousel = document.querySelector('.memory-carousel');
        var memoryTrack = memoryCarousel ? memoryCarousel.querySelector('.memory-track') : null;
        var memorySlideTemplates = memorySources.map(function (source, index) {
          return createMemorySlideTemplate(source, index);
        });
        var memoryQueue = [];
        var nextMemoryTemplateIndex = 0;
        var memoryTimer = null;
        var CAROUSEL_INTERVAL = 4200;
        var MEMORY_EXIT_DURATION = 640;
        var reduceMotionQuery = window.matchMedia ? window.matchMedia('(prefers-reduced-motion: reduce)') : null;
        var prefersReducedMotion = !!(reduceMotionQuery && reduceMotionQuery.matches);

        function createMemorySlideTemplate(source, index) {
          var wrapper = document.createElement('div');
          wrapper.className = 'dog-wrapper';
          var frame = document.createElement('div');
          frame.className = 'photo-frame';
          wrapper.appendChild(frame);
          var isVideo = /\.mp4$/i.test(source);
          if (isVideo) {
            var video = document.createElement('video');
            video.src = source;
            video.setAttribute('muted', '');
            video.muted = true;
            video.setAttribute('loop', '');
            video.loop = true;
            video.setAttribute('playsinline', '');
            video.playsInline = true;
            video.setAttribute('autoplay', '');
            video.autoplay = true;
            video.setAttribute('preload', 'metadata');
            video.setAttribute('aria-label', 'Prae memory video ' + (index + 1));
            frame.appendChild(video);
          } else {
            var img = document.createElement('img');
            img.src = source;
            img.alt = 'Prae memory photo ' + (index + 1);
            img.loading = 'eager';
            frame.appendChild(img);
          }
          return wrapper;
        }

        function activateMemoryMedia(node) {
          if (!node) {
            return;
          }
          var video = node.querySelector('video');
          if (video) {
            video.currentTime = 0;
            var playPromise = video.play();
            if (playPromise && playPromise.catch) {
              playPromise.catch(function () {
                // Ignore autoplay issues quietly
              });
            }
          }
        }

        function cloneMemorySlideFromTemplate(index) {
          if (!memorySlideTemplates.length) {
            return null;
          }
          var total = memorySlideTemplates.length;
          var normalizedIndex = ((index % total) + total) % total;
          var template = memorySlideTemplates[normalizedIndex];
          if (!template) {
            return null;
          }
          var clone = template.cloneNode(true);
          clone.setAttribute('aria-hidden', 'true');
          return clone;
        }

        function appendNextMemorySlide() {
          if (!memorySlideTemplates.length || !memoryTrack) {
            return null;
          }
          var clone = cloneMemorySlideFromTemplate(nextMemoryTemplateIndex);
          if (clone) {
            memoryTrack.appendChild(clone);
            memoryQueue.push(clone);
            nextMemoryTemplateIndex = (nextMemoryTemplateIndex + 1) % memorySlideTemplates.length;
            activateMemoryMedia(clone);
          }
          return clone;
        }

        function setMemorySlideState(slide, state) {
          if (!slide) {
            return;
          }
          var disableTransition = !slide.dataset.memoryReady;
          if (disableTransition) {
            slide.classList.add('is-static');
          }
          slide.classList.remove('is-active', 'is-prev', 'is-next', 'is-offscreen', 'is-exiting');
          if (state) {
            slide.classList.add(state);
          }
          slide.setAttribute('aria-hidden', state === 'is-active' ? 'false' : 'true');
          if (disableTransition) {
            // Force reflow before re-enabling transitions
            void slide.offsetWidth;
            slide.classList.remove('is-static');
            slide.dataset.memoryReady = 'true';
          }
        }

        function scheduleMemoryRemoval(slide) {
          if (!slide) {
            return;
          }
          slide.classList.remove('is-active', 'is-prev', 'is-next', 'is-offscreen');
          slide.classList.add('is-exiting');
          slide.setAttribute('aria-hidden', 'true');
          window.setTimeout(function () {
            if (slide && slide.parentNode === memoryTrack) {
              memoryTrack.removeChild(slide);
            }
          }, MEMORY_EXIT_DURATION);
        }

        function applyMemoryClasses() {
          if (!memoryQueue.length || !memoryTrack) {
            return;
          }
          if (!memoryTrack.classList.contains('is-enhanced')) {
            memoryTrack.classList.add('is-enhanced');
          }
          memoryQueue.forEach(function (slide, index) {
            if (index === 0) {
              setMemorySlideState(slide, 'is-prev');
            } else if (index === 1) {
              setMemorySlideState(slide, 'is-active');
            } else if (index === 2) {
              setMemorySlideState(slide, 'is-next');
            } else {
              setMemorySlideState(slide, 'is-offscreen');
            }
          });
        }

        function ensureActiveMemoryMedia() {
          if (memoryQueue.length > 1) {
            activateMemoryMedia(memoryQueue[1]);
          }
        }

        function advanceMemoryCarousel() {
          if (memoryQueue.length < 2 || !memoryTrack) {
            return;
          }
          var outgoing = memoryQueue.shift();
          appendNextMemorySlide();
          applyMemoryClasses();
          ensureActiveMemoryMedia();
          scheduleMemoryRemoval(outgoing);
        }

        function stopMemoryCarousel() {
          if (memoryTimer) {
            clearInterval(memoryTimer);
            memoryTimer = null;
          }
        }

        function startMemoryCarousel() {
          if (prefersReducedMotion || memoryQueue.length < 3) {
            return;
          }
          stopMemoryCarousel();
          memoryTimer = setInterval(advanceMemoryCarousel, CAROUSEL_INTERVAL);
        }

        function initMemoryCarousel() {
          if (!memoryTrack || !memorySlideTemplates.length) {
            return;
          }
          memoryQueue = [];
          nextMemoryTemplateIndex = 0;
          memoryTrack.innerHTML = '';
          var initialPrev = cloneMemorySlideFromTemplate(memorySlideTemplates.length - 1);
          if (initialPrev) {
            memoryTrack.appendChild(initialPrev);
            memoryQueue.push(initialPrev);
            activateMemoryMedia(initialPrev);
          }
          var guard = 0;
          while (memoryQueue.length < 3 && guard < memorySlideTemplates.length + 3) {
            appendNextMemorySlide();
            guard++;
          }
          applyMemoryClasses();
          ensureActiveMemoryMedia();
          if (!prefersReducedMotion) {
            startMemoryCarousel();
          }
        }

        if (memoryTrack && memorySlideTemplates.length) {
          initMemoryCarousel();
          if (memoryCarousel) {
            memoryCarousel.addEventListener('mouseenter', stopMemoryCarousel);
            memoryCarousel.addEventListener('mouseleave', function () {
              if (!prefersReducedMotion) {
                startMemoryCarousel();
              }
            });
            memoryCarousel.addEventListener('focusin', stopMemoryCarousel);
            memoryCarousel.addEventListener('focusout', function () {
              if (!prefersReducedMotion) {
                startMemoryCarousel();
              }
            });
          }
          if (reduceMotionQuery) {
            var handleReduceMotionChange = function (event) {
              prefersReducedMotion = !!event.matches;
              if (prefersReducedMotion) {
                stopMemoryCarousel();
              } else {
                if (!memoryQueue.length) {
                  initMemoryCarousel();
                }
                startMemoryCarousel();
              }
            };
            if (reduceMotionQuery.addEventListener) {
              reduceMotionQuery.addEventListener('change', handleReduceMotionChange);
            } else if (reduceMotionQuery.addListener) {
              reduceMotionQuery.addListener(handleReduceMotionChange);
            }
          }
        }

        var lyricLines = [
          { text: 'Jesus', duration: 3000 },
          { text: 'I was tossed in the water', duration: 3300 },
          { text: 'But I never went under', duration: 3000 },
          { text: 'You were always on time', duration: 5000 },
          { text: 'Jesus', duration: 3000 },
          { text: 'When I went through the fire', duration: 3300 },
          { text: 'You were right there beside me', duration: 3000 },
          { text: 'You were always on time', duration: 5000 },
          { text: 'You were always, always, always on time', duration: 8500 },
          { text: 'And You were always, always, always on time', duration: 8500 }
        ];
        var lyricWindow = document.querySelector('.lyrics-window');
        var lyricLineNodes = lyricWindow ? Array.prototype.slice.call(lyricWindow.querySelectorAll('.lyrics-line')) : [];
        var lyricDisplayIndex = 0;
        var lyricStatus = document.getElementById('lyrics-status');
        var lyricProgress = document.getElementById('lyrics-progress');
        var lyricModule = document.querySelector('.lyrics-module');
        var lyricIndex = 0;
        var lyricTimeout = null;
        var lyricBars = [];
        var lyricStarted = false;

        function getActiveLyricNode() {
          return lyricLineNodes[lyricDisplayIndex] || null;
        }

        function getInactiveLyricNode() {
          if (!lyricLineNodes.length) {
            return null;
          }
          var nextIndex = (lyricDisplayIndex + 1) % lyricLineNodes.length;
          return lyricLineNodes[nextIndex] || null;
        }

        function setLyricContent(node, text) {
          if (!node) {
            return;
          }
          var span = node.querySelector('span');
          if (span) {
            span.textContent = text || '';
          }
        }

        function resetLyricNode(node) {
          if (!node) {
            return;
          }
          if (node._fadeTimer) {
            clearTimeout(node._fadeTimer);
            node._fadeTimer = null;
          }
          node.classList.remove('is-visible', 'is-fading-out');
          node.setAttribute('aria-hidden', 'true');
          setLyricContent(node, '');
        }

        function buildLyricProgress() {
          if (!lyricProgress) {
            return;
          }
          lyricProgress.innerHTML = '';
          lyricLines.forEach(function (line, idx) {
            var bar = document.createElement('span');
            bar.setAttribute('data-index', idx);
            var duration = (line && line.duration) || 3200;
            bar.style.setProperty('--progress-duration', duration + 'ms');
            lyricProgress.appendChild(bar);
          });
          lyricBars = Array.prototype.slice.call(lyricProgress.querySelectorAll('span'));
        }

        function updateLyricProgress(activeIndex) {
          if (!lyricBars.length) {
            buildLyricProgress();
          }
          if (!lyricBars.length) {
            return;
          }
          lyricBars.forEach(function (bar, idx) {
            if (activeIndex === 0) {
              bar.classList.remove('is-complete');
            } else if (idx < activeIndex) {
              bar.classList.add('is-complete');
            } else {
              bar.classList.remove('is-complete');
            }
            if (idx === activeIndex) {
              bar.classList.remove('is-active');
              void bar.offsetWidth;
              bar.classList.add('is-active');
            } else {
              bar.classList.remove('is-active');
            }
          });
        }

        function updateLyricLine(nextIndex, animate, shouldUpdateProgress) {
          if (!lyricLineNodes.length) {
            return;
          }
          var targetLine = lyricLines[nextIndex] || lyricLines[0];
          if (!targetLine) {
            return;
          }
          if (!animate) {
            var initialNode = getActiveLyricNode() || lyricLineNodes[0];
            if (initialNode) {
              setLyricContent(initialNode, targetLine.text);
              initialNode.classList.add('is-visible');
              initialNode.setAttribute('aria-hidden', 'false');
            }
            var otherNode = getInactiveLyricNode();
            resetLyricNode(otherNode);
          } else {
            var outgoing = getActiveLyricNode();
            var incoming = getInactiveLyricNode();
            if (!incoming) {
              return;
            }
            if (incoming._fadeTimer) {
              clearTimeout(incoming._fadeTimer);
              incoming._fadeTimer = null;
            }
            setLyricContent(incoming, targetLine.text);
            incoming.classList.remove('is-visible', 'is-fading-out');
            incoming.setAttribute('aria-hidden', 'false');
            if (outgoing) {
              if (outgoing._fadeTimer) {
                clearTimeout(outgoing._fadeTimer);
                outgoing._fadeTimer = null;
              }
              outgoing.classList.remove('is-fading-out');
              outgoing.classList.remove('is-visible');
              outgoing.classList.add('is-fading-out');
              outgoing.setAttribute('aria-hidden', 'true');
              outgoing._fadeTimer = window.setTimeout(function () {
                outgoing.classList.remove('is-fading-out');
                setLyricContent(outgoing, '');
                outgoing._fadeTimer = null;
              }, 620);
            }
            requestAnimationFrame(function () {
              incoming.classList.add('is-visible');
            });
            lyricDisplayIndex = (lyricDisplayIndex + 1) % lyricLineNodes.length;
          }
          if (shouldUpdateProgress) {
            updateLyricProgress(nextIndex);
          }
        }

        function queueNextLyric() {
          if (lyricTimeout) {
            clearTimeout(lyricTimeout);
          }
          var line = lyricLines[lyricIndex] || lyricLines[0];
          var duration = (line && line.duration) || 3200;
          lyricTimeout = setTimeout(function () {
            lyricIndex = (lyricIndex + 1) % lyricLines.length;
            updateLyricLine(lyricIndex, true, true);
            queueNextLyric();
          }, duration);
        }

        function startLyricLoop() {
          if (lyricStarted || !lyricLineNodes.length) {
            return;
          }
          lyricStarted = true;
          updateLyricLine(lyricIndex, true, true);
          if (lyricStatus) {
            lyricStatus.classList.add('is-live');
          }
          queueNextLyric();
        }

        function restartLyricLoop() {
          if (!lyricStarted || !lyricLineNodes.length) {
            return;
          }
          if (lyricTimeout) {
            clearTimeout(lyricTimeout);
            lyricTimeout = null;
          }
          lyricIndex = 0;
          updateLyricLine(lyricIndex, true, true);
          queueNextLyric();
        }

        buildLyricProgress();
        updateLyricLine(lyricIndex, false, false);
        if (soundtrack) {
          soundtrack.addEventListener('ended', function () {
            restartLyricLoop();
          });
        }

        function revealScene() {
          if (introOverlay) {
            introOverlay.classList.add('is-hidden');
          }
          if (scene) {
            scene.classList.remove('is-blurred');
            scene.classList.add('is-revealed');
          }
          if (soundtrack && !hasQueuedSoundtrack) {
            hasQueuedSoundtrack = true;
            setTimeout(function () {
              // Start the soundtrack after the reveal tap with the shared delay
              soundtrack.muted = false;
              var playAttempt = soundtrack.play();
              if (playAttempt && playAttempt.catch) {
                playAttempt.catch(function () {
                  // Ignore play errors if additional gestures are required
                });
              }
            }, SOUNDTRACK_START_DELAY);
          }
          setTimeout(startLyricLoop, SOUNDTRACK_START_DELAY);
        }

        if (introButton) {
          introButton.addEventListener('click', revealScene);
        }
        if (!introOverlay) {
          startLyricLoop();
        }
      })();
    </script>
  </body>
</html>
